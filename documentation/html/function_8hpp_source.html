<!--
    Copyright 2005-2008 Adobe Systems Incorporated
    Distributed under the MIT License (see accompanying file LICENSE_1_0_0.txt
    or a copy at http://stlab.adobe.com/licenses.html)

    Some files are held under additional license.
    Please see "http://stlab.adobe.com/licenses.html" for more information.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <TITLE>Adobe Software Technology Lab: function.hpp Source File</TITLE>
    <META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1"/>
    <LINK TYPE="text/css" REL="stylesheet" HREF="adobe_source.css"/>
    <LINK REL="alternate" TITLE="stlab.adobe.com RSS" HREF="http://sourceforge.net/export/rss2_projnews.php?group_id=132417&amp;rss_fulltext=1" TYPE="application/rss+xml"/>
    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
</head>
<body>
<div id='content'>
<table><tr>
<td colspan='5'>
    <div id='opensource_banner'>
    <table style='width: 100%; padding: 5px;'><tr>
    <td align='left'>
        <a href='index.html' style='border: none'><img src='stlab2007.jpg' alt="stlab.adobe.com"/></a>
    </td>
    <td align='right'>
        <a href='http://www.adobe.com' style='border: none'><img src='adobe_hlogo.gif' alt="Adobe Systems Incorporated"/></a>
    </td>
    </tr></table>
    </div>
</td></tr><tr>
<td valign="top">
    <div id='navtable' height='100%'>
    <div style='margin: 5px'>
        <h4>Documentation</h4>

        <a href="group__asl__overview.html">Overview</a><br/>
        <a href="asl_readme.html">Building ASL</a><br/>
        <a href="asl_toc.html">Documentation</a><br/>
        <a href="http://stlab.adobe.com/wiki/index.php/Supplementary_ASL_Documentation">Library Wiki Docs</a><br/>
        <a href="asl_indices.html">Indices</a><br/>
        <a href="http://stlab.adobe.com/perforce/">Browse Perforce</a><br/>

        <h4>More Info</h4>

        <a href="asl_release_notes.html">Release Notes</a><br/>
        <a href="http://stlab.adobe.com/wiki/">Wiki</a><br/>
        <a href="asl_search.html">Site Search</a><br/>
        <a href="licenses.html">License</a><br/>
        <a href="success_stories.html">Success Stories</a><br/>
        <a href="asl_contributors.html">Contributors</a><br/>

        <h4>Media</h4>

        <a href="http://sourceforge.net/project/showfiles.php?group_id=132417&amp;package_id=145420">Download</a><br/>
        <a href="asl_download_perforce.html">Perforce Depots</a><br/>

        <h4>Support</h4>

        <a href="http://sourceforge.net/projects/adobe-source/">ASL SourceForge Home</a><br/>
        <a href="http://sourceforge.net/mail/?group_id=132417">Mailing Lists</a><br/>
        <a href="http://sourceforge.net/forum/?group_id=132417">Discussion Forums</a><br/>
        <a href="http://sourceforge.net/tracker/?atid=724218&amp;group_id=132417&amp;func=browse">Report Bugs</a><br/>
        <a href="http://sourceforge.net/tracker/?atid=724221&amp;group_id=132417&amp;func=browse">Suggest Features</a><br/>
        <a href="asl_contributing.html">Contribute to ASL</a><br/>

        <h4>RSS</h4>

        <a href="http://sourceforge.net/export/rss2_projnews.php?group_id=132417">Short-text news</a><br/>
        <a href="http://sourceforge.net/export/rss2_projnews.php?group_id=132417&amp;rss_fulltext=1">Full-text news</a><br/>
        <a href="http://sourceforge.net/export/rss2_projfiles.php?group_id=132417">File releases</a><br/>

        <h4>Other Adobe Projects</h4>

        <a href="http://sourceforge.net/adobe/">Open @ Adobe</a><br/>
        <a href="http://opensource.adobe.com/">Adobe Open Source</a><br/>
        <a href="http://labs.adobe.com/">Adobe Labs</a><br/>
        <a href="http://stlab.adobe.com/amg/">Adobe Media Gallery</a><br/>
        <a href="http://stlab.adobe.com/performance/">C++ Benchmarks</a><br/>

        <h4>Other Resources</h4>

        <a href="http://boost.org">Boost</a><br/>
        <a href="http://www.riaforge.com/">RIAForge</a><br/>
        <a href="http://www.sgi.com/tech/stl">SGI STL</a><br/>
    </div>
    </div>
</td>
<td id='maintable' width="100%" valign="top">

<!-- End Header -->
<!-- Generated by Doxygen 1.7.2 -->
<div class="header">
  <div class="headertitle">
<h1>function.hpp</h1>  </div>
</div>
<div class="contents">
<a href="function_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright 2005-2007 Adobe Systems Incorporated</span>
<a name="l00003"></a>00003 <span class="comment">    Distributed under the MIT License (see accompanying file LICENSE_1_0_0.txt</span>
<a name="l00004"></a>00004 <span class="comment">    or a copy at http://stlab.adobe.com/licenses.html)</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/**************************************************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#ifndef ADOBE_FUNCTION_HPP</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#define ADOBE_FUNCTION_HPP</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;exception&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;tr1/functional&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;tr1/type_traits&gt;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;boost/bind.hpp&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="cstdint_8hpp.html">adobe/cstdint.hpp</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="string_8hpp.html">adobe/string.hpp</a>&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">/**************************************************************************************************/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">namespace </span>adobe {
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">/**************************************************************************************************/</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classadobe_1_1marshaled__exception.html">00029</a> <span class="keyword">class </span><a class="code" href="classadobe_1_1marshaled__exception.html">marshaled_exception</a> : <span class="keyword">public</span> std::exception {
<a name="l00030"></a>00030  <span class="keyword">public</span>:
<a name="l00031"></a><a class="code" href="classadobe_1_1marshaled__exception.html#a47a326caac8581fc2a9fdfddaac371a2">00031</a>     <span class="keyword">explicit</span> <a class="code" href="classadobe_1_1marshaled__exception.html#a47a326caac8581fc2a9fdfddaac371a2">marshaled_exception</a>(<a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a> message) : message_m(<a class="code" href="group__move__related.html#ga19621039777830b4c316f8956bc5d42f" title="This version of move is selected when T is_movable . It in turn calls the move constructor. This call, with the help of the return value optimization, will cause x to be moved instead of copied to its destination. See adobe/test/move/main.cpp for examples.">move</a>(message)) { }
<a name="l00032"></a><a class="code" href="classadobe_1_1marshaled__exception.html#a1f39821bb1e55e28f154681272361372">00032</a>     <a class="code" href="classadobe_1_1marshaled__exception.html#a1f39821bb1e55e28f154681272361372">~marshaled_exception</a>() throw() { }
<a name="l00033"></a><a class="code" href="classadobe_1_1marshaled__exception.html#a586eee248fedb7de1b50219e14b99c7b">00033</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classadobe_1_1marshaled__exception.html#a586eee248fedb7de1b50219e14b99c7b">what</a>() <span class="keyword">const</span> throw() { <span class="keywordflow">return</span> message_m.<a class="code" href="classadobe_1_1version__1_1_1string__t.html#a89da6be964480b4c86334e4e337d3cf2">c_str</a>(); }
<a name="l00034"></a>00034  <span class="keyword">private</span>:
<a name="l00035"></a>00035     <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a> message_m;
<a name="l00036"></a>00036 };
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="namespaceadobe.html#a8c83013000304c27b3b7cc09c07bbd6c">00038</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespaceadobe.html#a8c83013000304c27b3b7cc09c07bbd6c">current_exception_what</a>() {
<a name="l00039"></a>00039     <span class="keyword">const</span> <span class="keywordtype">char</span>* result = <span class="stringliteral">&quot;unknown_exception&quot;</span>;
<a name="l00040"></a>00040     
<a name="l00041"></a>00041     <span class="keywordflow">try</span> { <span class="keywordflow">throw</span>; }
<a name="l00042"></a>00042     <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; error) {
<a name="l00043"></a>00043         <span class="keywordflow">if</span> (error.what()) result = error.what();
<a name="l00044"></a>00044     } <span class="keywordflow">catch</span> (...) { }
<a name="l00045"></a>00045     
<a name="l00046"></a>00046     <span class="keywordflow">return</span> result;
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">00049</a> <span class="keyword">struct </span>void_;
<a name="l00050"></a>00050 <span class="keyword">typedef</span> void_* <a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/**************************************************************************************************/</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">namespace </span>implementation {
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00057"></a>00057 <span class="keyword">class </span>function_base {
<a name="l00058"></a>00058  <span class="keyword">public</span>:
<a name="l00059"></a>00059     <span class="comment">// [3.7.2.2] function modifiers</span>
<a name="l00060"></a>00060     <span class="keywordtype">void</span> <a class="code" href="namespaceadobe.html#a5c6656b2ba51d81c71a97670f3b15a83">swap</a>(T&amp; x) { <a class="code" href="namespaceadobe.html#a5c6656b2ba51d81c71a97670f3b15a83">std::swap</a>(<span class="keyword">self</span>()-&gt;object_m, x.object_m); }
<a name="l00061"></a>00061  
<a name="l00062"></a>00062     <span class="comment">// [3.7.2.3] function capacity</span>
<a name="l00063"></a>00063     operator bool()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">self</span>()-&gt;object_m; }
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     <span class="comment">// [3.7.2.5] function target access</span>
<a name="l00066"></a>00066     <span class="comment">/* Not provided:</span>
<a name="l00067"></a>00067 <span class="comment">        const std::type_info&amp; target_type() const;</span>
<a name="l00068"></a>00068 <span class="comment">        template &lt;typename T&gt; T* target();</span>
<a name="l00069"></a>00069 <span class="comment">        template &lt;typename T&gt; const T* target() const;</span>
<a name="l00070"></a>00070 <span class="comment">    */</span>
<a name="l00071"></a>00071     
<a name="l00072"></a>00072     <span class="keyword">friend</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespaceadobe.html#a5c6656b2ba51d81c71a97670f3b15a83">swap</a>(T&amp; x, T&amp; y) { x.swap(y); }
<a name="l00073"></a>00073  <span class="keyword">private</span>: 
<a name="l00074"></a>00074     operator int() <span class="keyword">const</span>; <span class="comment">// for safe bool cast</span>
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     T* <span class="keyword">self</span>() { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>T*<span class="keyword">&gt;</span>(<span class="keyword">this</span>); }
<a name="l00077"></a>00077     <span class="keyword">const</span> T* <span class="keyword">self</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>T*<span class="keyword">&gt;</span>(<span class="keyword">this</span>); }
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Concept, <span class="keyword">typename</span> Apply&gt;
<a name="l00081"></a>00081 <span class="keyword">struct </span>vtable {
<a name="l00082"></a>00082     void (*<a class="code" href="namespaceadobe.html#a5552b0f660612c91fd30793df8d06091">destroy</a>)(Concept*);
<a name="l00083"></a>00083     Concept* (*copy)(<span class="keyword">const</span> Concept*, string_t&amp; message);
<a name="l00084"></a>00084     Apply apply;
<a name="l00085"></a>00085 };
<a name="l00086"></a>00086     
<a name="l00087"></a>00087 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Concept, <span class="keyword">typename</span> V&gt;
<a name="l00088"></a>00088 <span class="keyword">struct </span>concept_base_t {
<a name="l00089"></a>00089     <span class="keyword">explicit</span> concept_base_t(<span class="keyword">const</span> V* x) : vtable_m(x) { }
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     Concept* <a class="code" href="group__copy.html#ga213e2d8058f7aab229cb3b6099634256" title="copy implementation">copy</a>()<span class="keyword"> const </span>{
<a name="l00092"></a>00092         string_t message;
<a name="l00093"></a>00093         Concept* result = vtable_m-&gt;copy(<span class="keyword">self</span>(), message);
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (message) <span class="keywordflow">throw</span> marshaled_exception(<a class="code" href="group__move__related.html#ga19621039777830b4c316f8956bc5d42f" title="This version of move is selected when T is_movable . It in turn calls the move constructor. This call, with the help of the return value optimization, will cause x to be moved instead of copied to its destination. See adobe/test/move/main.cpp for examples.">move</a>(message));
<a name="l00095"></a>00095         <span class="keywordflow">return</span> result;
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097     
<a name="l00098"></a>00098     <span class="keywordtype">void</span> <a class="code" href="namespaceadobe.html#a5552b0f660612c91fd30793df8d06091">destroy</a>() { vtable_m-&gt;destroy(<span class="keyword">self</span>()); }
<a name="l00099"></a>00099     
<a name="l00100"></a>00100     Concept* <span class="keyword">self</span>() { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>Concept*<span class="keyword">&gt;</span>(<span class="keyword">this</span>); }
<a name="l00101"></a>00101     <span class="keyword">const</span> Concept* <span class="keyword">self</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Concept*<span class="keyword">&gt;</span>(<span class="keyword">this</span>); }
<a name="l00102"></a>00102     
<a name="l00103"></a>00103     <span class="keyword">const</span> V* vtable_m;
<a name="l00104"></a>00104 };
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Model,
<a name="l00107"></a>00107           <span class="keyword">typename</span> Concept&gt;
<a name="l00108"></a>00108 <span class="keyword">struct </span>model_base : Concept {
<a name="l00109"></a>00109     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00110"></a>00110     <span class="keyword">explicit</span> model_base(T x) : Concept(x) { }
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <span class="keyword">static</span> Model* <span class="keyword">self</span>(Concept* x) { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>Model*<span class="keyword">&gt;</span>(x); }
<a name="l00113"></a>00113     <span class="keyword">static</span> <span class="keyword">const</span> Model* <span class="keyword">self</span>(<span class="keyword">const</span> Concept* x) { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Model*<span class="keyword">&gt;</span>(x); }
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespaceadobe.html#a5552b0f660612c91fd30793df8d06091">destroy</a>(Concept* x) { <span class="keyword">delete</span> <span class="keyword">self</span>(x); }
<a name="l00116"></a>00116     
<a name="l00117"></a>00117     <span class="keyword">static</span> Concept* <a class="code" href="group__copy.html#ga213e2d8058f7aab229cb3b6099634256" title="copy implementation">copy</a>(<span class="keyword">const</span> Concept* x, string_t&amp; message) {
<a name="l00118"></a>00118         Concept* result = 0;
<a name="l00119"></a>00119         
<a name="l00120"></a>00120         <span class="keywordflow">try</span> {
<a name="l00121"></a>00121             result = <span class="keyword">new</span> Model(*<span class="keyword">self</span>(x));
<a name="l00122"></a>00122         } <span class="keywordflow">catch</span> (...) {
<a name="l00123"></a>00123             message = <a class="code" href="namespaceadobe.html#a8c83013000304c27b3b7cc09c07bbd6c">current_exception_what</a>();
<a name="l00124"></a>00124         }
<a name="l00125"></a>00125         
<a name="l00126"></a>00126         <span class="keywordflow">return</span> result;
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128 };
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T&gt;
<a name="l00131"></a>00131 <span class="keyword">typename</span> F::concept_t* make_model(<span class="keyword">const</span> T&amp; x) {
<a name="l00132"></a>00132     <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keyword">typename</span> F::template model&lt;T&gt;(x);
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T&gt;
<a name="l00136"></a>00136 <span class="keyword">typename</span> F::concept_t* create_model(<span class="keyword">const</span> T&amp; x, std::tr1::true_type) {
<a name="l00137"></a>00137     <span class="keywordflow">return</span> x ? make_model&lt;F&gt;(boost::bind&lt;typename F::result_type&gt;(x)) : 0;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T&gt;
<a name="l00141"></a>00141 <span class="keyword">typename</span> F::concept_t* create_model(<span class="keyword">const</span> T&amp; x, std::tr1::false_type) {
<a name="l00142"></a>00142     <span class="keywordflow">return</span> make_model&lt;F&gt;(boost::bind&lt;typename F::result_type&gt;(x));
<a name="l00143"></a>00143 }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> T&gt;
<a name="l00146"></a>00146 <span class="keyword">typename</span> F::concept_t* create_model(<span class="keyword">const</span> T&amp; x) {
<a name="l00147"></a>00147     <span class="keywordflow">return</span> create_model&lt;F&gt;(x, std::tr1::is_pointer&lt;T&gt;());
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 } <span class="comment">// namespace implementation</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment">/**************************************************************************************************/</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="keyword">namespace </span>version_1 {
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/**************************************************************************************************/</span>
<a name="l00157"></a>00157 
<a name="l00163"></a>00163 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keyword">class </span>function;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/**************************************************************************************************/</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">// [3.7.2.7] null pointer comparisons</span>
<a name="l00168"></a><a class="code" href="namespaceadobe_1_1version__1.html#ad63d9d3912bf75d3272a1c6816088463">00168</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keywordtype">bool</span> <a class="code" href="namespaceadobe_1_1version__1.html#ad63d9d3912bf75d3272a1c6816088463">operator==</a>(<span class="keyword">const</span> function&lt;F&gt;&amp; x, <a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>) { <span class="keywordflow">return</span> !x; }
<a name="l00169"></a><a class="code" href="namespaceadobe_1_1version__1.html#a36ced1d05ea0ef820c3c00b3a10e6f77">00169</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keywordtype">bool</span> <a class="code" href="namespaceadobe_1_1version__1.html#ad63d9d3912bf75d3272a1c6816088463">operator==</a>(<a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>, <span class="keyword">const</span> function&lt;F&gt;&amp; x) { <span class="keywordflow">return</span> !x; }
<a name="l00170"></a><a class="code" href="namespaceadobe_1_1version__1.html#a1038053253f6c669b291553f99f3f48d">00170</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keywordtype">bool</span> <a class="code" href="namespaceadobe_1_1version__1.html#a1038053253f6c669b291553f99f3f48d">operator!=</a>(<span class="keyword">const</span> function&lt;F&gt;&amp; x, <a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>) { <span class="keywordflow">return</span> x; }
<a name="l00171"></a><a class="code" href="namespaceadobe_1_1version__1.html#ab340f7a29813511ae1000c27ec7f86c8">00171</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keywordtype">bool</span> <a class="code" href="namespaceadobe_1_1version__1.html#a1038053253f6c669b291553f99f3f48d">operator!=</a>(<a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>, <span class="keyword">const</span> function&lt;F&gt;&amp; x) { <span class="keywordflow">return</span> x; }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/**************************************************************************************************/</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> R&gt;
<a name="l00176"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html">00176</a> <span class="keyword">class </span>function&lt;R ()&gt; : <span class="keyword">public</span> implementation::function_base&lt;function&lt;R ()&gt; &gt;
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178  <span class="keyword">public</span>:
<a name="l00179"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a193ad0c1f88592f4f1702c09ec59e7ea">00179</a>     <span class="keyword">typedef</span> R <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a193ad0c1f88592f4f1702c09ec59e7ea">result_type</a>;
<a name="l00180"></a>00180  
<a name="l00181"></a>00181     <span class="comment">// [3.7.2.1] construction/copy/destroy</span>
<a name="l00182"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ac2ffb26d6f42d3bbcd7847b0873403f4">00182</a>     <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ac2ffb26d6f42d3bbcd7847b0873403f4">function</a>() : object_m(0) { }
<a name="l00183"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a14cca1c8a7393d61ed9ae1aff1e9b9d0">00183</a>     <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a14cca1c8a7393d61ed9ae1aff1e9b9d0">function</a>(<a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>) : object_m(0) { }
<a name="l00184"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#aec2d6904cab522441c78a6fa9cfa738d">00184</a>     <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#aec2d6904cab522441c78a6fa9cfa738d">function</a>(<span class="keyword">const</span> function&amp; x) : object_m(x.object_m ? x.object_m-&gt;<a class="code" href="group__copy.html#ga213e2d8058f7aab229cb3b6099634256" title="copy implementation">copy</a>() : 0) { }
<a name="l00185"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a89af398a479daa1dd4b30e8b97649df8">00185</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a89af398a479daa1dd4b30e8b97649df8">function</a>(T x) : object_m(implementation::create_model&lt;function&gt;(x)) { }
<a name="l00186"></a>00186     
<a name="l00187"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a3ccd0cb4f22358d95e0ca029dde84c46">00187</a>     function&amp; <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a3ccd0cb4f22358d95e0ca029dde84c46">operator=</a>(function x) { <a class="code" href="namespaceadobe.html#a5c6656b2ba51d81c71a97670f3b15a83">swap</a>(*<span class="keyword">this</span>, x); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00188"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#aa9725d724645e10c0ec20d909b451e95">00188</a>     function&amp; <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#aa9725d724645e10c0ec20d909b451e95">operator=</a>(<a class="code" href="namespaceadobe.html#aa629c528fd79bb90068cb07114a4d79a">null_ptr_t</a>) { <span class="keywordflow">if</span> (object_m) object_m-&gt;destroy(); object_m = 0; }
<a name="l00189"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a673e8c4c4b434ac46e39fc6779e97366">00189</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; function&amp; <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#a673e8c4c4b434ac46e39fc6779e97366">operator=</a>(T x) { <span class="keywordflow">return</span> *<span class="keyword">this</span> = function(x); }
<a name="l00190"></a>00190     <span class="comment">// template&lt;class F&gt; function&amp; operator=(reference_wrapper&lt;F&gt;);</span>
<a name="l00191"></a>00191     
<a name="l00192"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ab1218d1426c47c35d85687d15f317b97">00192</a>     <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ab1218d1426c47c35d85687d15f317b97">~function</a>() { <span class="keywordflow">if</span> (object_m) object_m-&gt;destroy(); }
<a name="l00193"></a>00193     
<a name="l00194"></a>00194     <span class="comment">// [3.7.2.4] function invocation</span>
<a name="l00195"></a><a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ae6244e50b15547a1509baedd6037ce2c">00195</a>     R <a class="code" href="classadobe_1_1version__1_1_1function_3_01R_07_08_4.html#ae6244e50b15547a1509baedd6037ce2c">operator()</a>()<span class="keyword"> const </span>{
<a name="l00196"></a>00196         <span class="keywordflow">if</span> (!object_m) <span class="keywordflow">throw</span> std::tr1::bad_function_call();
<a name="l00197"></a>00197         <span class="keywordflow">return</span> object_m-&gt;apply();
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199     
<a name="l00200"></a>00200     <span class="keyword">struct </span><a class="code" href="classconcept__t.html">concept_t</a>;  <span class="comment">// implementation</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keyword">private</span>:
<a name="l00203"></a>00203     <span class="keyword">friend</span> <span class="keyword">class </span>implementation::function_base&lt;function&lt;R ()&gt; &gt;;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keyword">typedef</span> implementation::vtable&lt;concept_t, R (*)(concept_t*, string_t&amp;)&gt; vtable_type;
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="comment">/*</span>
<a name="l00208"></a>00208 <span class="comment">    REVISIT (sparent) : This section is an implementation detail - made public until I can figure</span>
<a name="l00209"></a>00209 <span class="comment">    out how to make template friends.</span>
<a name="l00210"></a>00210 <span class="comment">    */</span>
<a name="l00211"></a>00211   
<a name="l00212"></a>00212   <span class="keyword">public</span>:
<a name="l00213"></a>00213   
<a name="l00214"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html">00214</a>     <span class="keyword">struct </span><a class="code" href="classconcept__t.html">concept_t</a> : implementation::concept_base_t&lt;concept_t, vtable_type&gt; {
<a name="l00215"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a3cbe6c9c3c04ac2d315618cdb57f3127">00215</a>         <span class="keyword">typedef</span> implementation::concept_base_t&lt;concept_t, vtable_type&gt; <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a3cbe6c9c3c04ac2d315618cdb57f3127">base_type</a>;
<a name="l00216"></a>00216                 
<a name="l00217"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#abad11622fc4eee583e4f48ab179521a7">00217</a>         <span class="keyword">explicit</span> <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#abad11622fc4eee583e4f48ab179521a7">concept_t</a>(<span class="keyword">const</span> vtable_type* x) : <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a3cbe6c9c3c04ac2d315618cdb57f3127">base_type</a>(x) { }
<a name="l00218"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a181aef99d7d9c3aad30275687823e31b">00218</a>         R <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a181aef99d7d9c3aad30275687823e31b">apply</a>() {
<a name="l00219"></a>00219             <span class="keywordflow">return</span> apply(<span class="keyword">typename</span> std::tr1::is_void&lt;R&gt;());
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221         
<a name="l00222"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#aa4d35ddca220d080fb123ca4836de984">00222</a>         <span class="keywordtype">void</span> <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#aa4d35ddca220d080fb123ca4836de984">apply</a>(std::tr1::true_type) {
<a name="l00223"></a>00223             <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a> message;
<a name="l00224"></a>00224             this-&gt;vtable_m-&gt;apply(<span class="keyword">this</span>, message);
<a name="l00225"></a>00225             <span class="keywordflow">if</span> (message) <span class="keywordflow">throw</span> <a class="code" href="classadobe_1_1marshaled__exception.html">marshaled_exception</a>(<a class="code" href="group__move__related.html#ga19621039777830b4c316f8956bc5d42f" title="This version of move is selected when T is_movable . It in turn calls the move constructor. This call, with the help of the return value optimization, will cause x to be moved instead of copied to its destination. See adobe/test/move/main.cpp for examples.">move</a>(message));
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         
<a name="l00228"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a9b1f05cf78eb19ff99fbcb6b2dfddae6">00228</a>         R <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1concept__t.html#a9b1f05cf78eb19ff99fbcb6b2dfddae6">apply</a>(std::tr1::false_type) {
<a name="l00229"></a>00229             <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a> message;
<a name="l00230"></a>00230             R result = this-&gt;vtable_m-&gt;apply(<span class="keyword">this</span>, message);
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (message) <span class="keywordflow">throw</span> <a class="code" href="classadobe_1_1marshaled__exception.html">marshaled_exception</a>(<a class="code" href="group__move__related.html#ga19621039777830b4c316f8956bc5d42f" title="This version of move is selected when T is_movable . It in turn calls the move constructor. This call, with the help of the return value optimization, will cause x to be moved instead of copied to its destination. See adobe/test/move/main.cpp for examples.">move</a>(message));
<a name="l00232"></a>00232             <span class="keywordflow">return</span> result;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234     };
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00237"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html">00237</a>     <span class="keyword">struct </span>model : implementation::model_base&lt;model&lt;T&gt;, concept_t&gt; {
<a name="l00238"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a5157e732225c20bd366449e0d515dd73">00238</a>         <span class="keyword">typedef</span> implementation::model_base&lt;model&lt;T&gt;, <a class="code" href="classconcept__t.html">concept_t</a>&gt; <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a5157e732225c20bd366449e0d515dd73">base_type</a>;
<a name="l00239"></a>00239         
<a name="l00240"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#af0f822a8d8d415020f75a589d09ec3cd">00240</a>         <span class="keyword">explicit</span> <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#af0f822a8d8d415020f75a589d09ec3cd">model</a>(T x) : <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a5157e732225c20bd366449e0d515dd73">base_type</a>(&amp;vtable_s), function_m(x) { }
<a name="l00241"></a>00241                 
<a name="l00242"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#ad5819304d651098abeb1663dca8076d6">00242</a>         <span class="keyword">static</span> R <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#ad5819304d651098abeb1663dca8076d6">apply</a>(<a class="code" href="classconcept__t.html">concept_t</a>* x, <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a>&amp; message) {
<a name="l00243"></a>00243             <span class="keywordflow">return</span> apply(x, message, <span class="keyword">typename</span> std::tr1::is_void&lt;R&gt;());
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245         
<a name="l00246"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a98054be1a1c51e993d30428009973cf1">00246</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a98054be1a1c51e993d30428009973cf1">apply</a>(<a class="code" href="classconcept__t.html">concept_t</a>* x, <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a>&amp; message, std::tr1::true_type) {
<a name="l00247"></a>00247             <span class="keywordflow">try</span> {
<a name="l00248"></a>00248                 <span class="keyword">static_cast&lt;</span>model*<span class="keyword">&gt;</span>(x)-&gt;function_m();
<a name="l00249"></a>00249             } <span class="keywordflow">catch</span> (...) {
<a name="l00250"></a>00250                 message = <a class="code" href="namespaceadobe.html#a8c83013000304c27b3b7cc09c07bbd6c">current_exception_what</a>();
<a name="l00251"></a>00251             }
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253         
<a name="l00254"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a8212c22cd21f2fae6efdb7be0777947a">00254</a>         <span class="keyword">static</span> R <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a8212c22cd21f2fae6efdb7be0777947a">apply</a>(<a class="code" href="classconcept__t.html">concept_t</a>* x, <a class="code" href="classadobe_1_1version__1_1_1string__t.html">string_t</a>&amp; message, std::tr1::false_type) {
<a name="l00255"></a>00255             R result;
<a name="l00256"></a>00256             <span class="keywordflow">try</span> {
<a name="l00257"></a>00257                 result = <span class="keyword">static_cast&lt;</span>model*<span class="keyword">&gt;</span>(x)-&gt;function_m();
<a name="l00258"></a>00258             } <span class="keywordflow">catch</span> (...) {
<a name="l00259"></a>00259                 message = <a class="code" href="namespaceadobe.html#a8c83013000304c27b3b7cc09c07bbd6c">current_exception_what</a>();
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261             <span class="keywordflow">return</span> result;
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         
<a name="l00264"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#aef9c0a37f96a42af948cc7b5a72f4714">00264</a>         <span class="keyword">static</span> <span class="keyword">const</span> vtable_type <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#aef9c0a37f96a42af948cc7b5a72f4714">vtable_s</a>;
<a name="l00265"></a><a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a769ccc73301d131259f13241a0bd653e">00265</a>         T <a class="code" href="structadobe_1_1version__1_1_1function_3_01R_07_08_4_1_1model.html#a769ccc73301d131259f13241a0bd653e">function_m</a>;
<a name="l00266"></a>00266     };
<a name="l00267"></a>00267     
<a name="l00268"></a>00268  <span class="keyword">private</span>:
<a name="l00269"></a>00269     concept_t* object_m;
<a name="l00270"></a>00270 };
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> R&gt;
<a name="l00273"></a>00273 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00274"></a>00274 <span class="keyword">const</span> <span class="keyword">typename</span> function&lt;R ()&gt;::vtable_type function&lt;R ()&gt;::model&lt;T&gt;::vtable_s = {
<a name="l00275"></a>00275     &amp;<a class="code" href="namespaceadobe.html#a5552b0f660612c91fd30793df8d06091">model::destroy</a>,
<a name="l00276"></a>00276     &amp;<a class="code" href="group__copy.html#ga213e2d8058f7aab229cb3b6099634256" title="copy implementation">model::copy</a>,
<a name="l00277"></a>00277     &amp;model::apply
<a name="l00278"></a>00278 };
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">/**************************************************************************************************/</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 } <span class="comment">// namespace version_1</span>
<a name="l00283"></a>00283 <span class="keyword">using namespace </span>version_1;
<a name="l00284"></a>00284 } <span class="comment">// namespace adobe</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">/**************************************************************************************************/</span>
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="preprocessor">#endif</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>
<a name="l00290"></a>00290 <span class="comment">/**************************************************************************************************/</span>
</pre></div></div>
</div>

<!-- Begin Footer -->
</td></tr>
</table>
</div> <!-- content -->
<div class='footerdiv'>
    <div id='footersub'>
        <ul>
            <li><a href="http://www.adobe.com/go/gftray_foot_aboutadobe">Company</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_privacy_security">Online Privacy Policy</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_terms">Terms of Use</a>&nbsp;|&nbsp;</li>
    
            <li><a href="http://www.adobe.com/go/gftray_foot_contact_adobe">Contact Us</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_accessibility">Accessibility</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_report_piracy">Report Piracy</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_permissions_trademarks">Permissions &amp; Trademarks</a>&nbsp;|&nbsp;</li>
            <li><a href="http://www.adobe.com/go/gftray_foot_product_license_agreements">Product License Agreements</a>&nbsp;|&nbsp;</li>
    
            <li><a href="http://www.adobe.com/go/gftray_foot_feedback">Send Feedback</a></li>
        </ul>
        <div>
            <p>Copyright &#169; 2006-2007 Adobe Systems Incorporated.</p>
            <p>Use of this website signifies your agreement to the <a href="http://www.adobe.com/go/gftray_foot_terms">Terms of Use</a> and <a href="http://www.adobe.com/go/gftray_foot_privacy_security">Online Privacy Policy</a>.</p>
            <p>Search powered by <a href="http://www.google.com/" target="new">Google</a></p>
        </div>
	</div>
</div>
<script type="text/javascript">
_uacct = "UA-396569-1";
urchinTracker();
</script>
</body>
</html>
